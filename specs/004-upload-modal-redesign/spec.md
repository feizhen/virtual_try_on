# Feature Specification: 虚拟试衣模态与服装上传选择界面

**Feature Branch**: `004-upload-modal-redesign`
**Created**: 2025-10-22
**Status**: Draft
**Input**: User description: "参考 documents/design/Wireframe - 1.png 和 upload.jpg 作为设计图并调整模态和图片上传页面"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 选择虚拟试衣模特 (Priority: P1)

用户需要在开始虚拟试衣前选择一个基础模特形象，作为试衣的展示载体。

**Why this priority**: 这是虚拟试衣流程的第一步，没有模特选择就无法进行后续的试衣操作，是整个功能的基础。

**Independent Test**: 可以通过打开应用、查看模特选择界面、点击不同模特缩略图并确认预览区域更新来独立测试此功能。

**Acceptance Scenarios**:

1. **Given** 用户打开虚拟试衣页面，**When** 页面加载完成，**Then** 底部显示"Select Model"区域，展示至少2个预设模特缩略图
2. **Given** 用户看到多个模特选项，**When** 点击某个模特缩略图，**Then** 该缩略图显示选中状态（红色边框高亮），主预览区域更新为该模特的完整展示图
3. **Given** 用户已选择模特A，**When** 切换选择模特B，**Then** 模特B的缩略图变为选中状态（红色边框），模特A的缩略图恢复未选中状态，预览区域更新为模特B

---

### User Story 2 - 上传服装到资源库 (Priority: P1)

用户需要上传自己的服装图片到系统，建立个人服装库，作为后续虚拟试衣的素材来源。

**Why this priority**: 服装上传是虚拟试衣的核心前置功能，没有服装素材就无法进行试衣操作。这是P1优先级因为它是MVP的必需功能。

**Independent Test**: 可以通过点击右侧"衣服"区域、展开后点击虚线框上传区域、选择文件上传、查看上传后的服装卡片来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在虚拟试衣页面，**When** 点击右侧"衣服"标题旁的"-"按钮（已展开状态），**Then** 展开区域显示虚线框的上传区域，内有"upload from files"按钮
2. **Given** 上传区域已展开，**When** 用户点击"upload from files"按钮或点击虚线框区域，**Then** 打开系统文件选择对话框
3. **Given** 文件选择对话框已打开，**When** 用户选择一张或多张图片文件（JPG/PNG/WEBP）并确认，**Then** 显示上传进度指示器
4. **Given** 服装图片上传完成，**When** 上传成功，**Then** 新服装以卡片形式出现在"衣服"区域的网格列表中，显示服装图片、名称、"IN STOCK"状态和数量"1"
5. **Given** 用户已有多件上传的服装，**When** 展开"衣服"区域，**Then** 显示所有服装的卡片网格（3列布局），每行显示3件服装

---

### User Story 3 - 选择服装进行虚拟试衣 (Priority: P1)

用户需要从已上传的服装库中选择一件衣服，应用到当前选中的模特身上，查看虚拟试衣效果。

**Why this priority**: 这是虚拟试衣的核心交互，直接决定用户能否看到试衣效果。选择服装是P1功能，因为这是用户的核心需求。

**Independent Test**: 可以通过在已有服装库的情况下，点击某件服装卡片，观察卡片高亮状态和左侧模特预览区域的更新来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户已上传至少1件服装且"衣服"区域已展开，**When** 点击某件服装的卡片，**Then** 该卡片显示红色边框高亮，表示选中状态
2. **Given** 用户选中某件服装，**When** 选中成功，**Then** 左侧主预览区域的模特图像更新，显示该模特穿上所选服装的效果
3. **Given** 用户已选中服装A，**When** 点击另一件服装B的卡片，**Then** 服装B的卡片变为红色边框高亮，服装A的边框恢复正常，预览区域更新为服装B的试衣效果
4. **Given** 用户选中服装后，**When** 切换选择不同的模特，**Then** 新模特也穿着当前选中的服装显示在预览区域

---

### User Story 4 - 折叠区域交互管理 (Priority: P2)

用户需要通过折叠/展开控件来管理界面空间，控制"衣服"和"场景"区域的显示状态，避免界面过于拥挤。

**Why this priority**: 这是UI交互的辅助功能，提升内容浏览效率。它是P2优先级因为即使没有折叠功能，用户仍可以完成核心试衣操作。

**Independent Test**: 可以通过点击"衣服"或"场景"区域的展开/收起按钮，观察区域状态变化来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在虚拟试衣页面，**When** 页面初次加载，**Then** "衣服"区域默认收起状态，只显示标题"衣服"和"-"按钮
2. **Given** "衣服"区域处于收起状态，**When** 点击"-"按钮，**Then** 区域展开，显示上传区域和服装网格列表，按钮保持为"-"图标
3. **Given** "衣服"区域处于展开状态，**When** 点击"-"按钮，**Then** 区域收起，隐藏内容列表，按钮变为"+"图标
4. **Given** 用户查看"场景"区域，**When** 点击"场景"旁的"+"按钮，**Then** 场景区域展开，显示场景上传和选择界面

---

### User Story 5 - 管理场景背景库 (Priority: P3)

用户需要上传和选择场景背景图片，以便在虚拟试衣时更换不同的展示背景环境。

**Why this priority**: 场景背景是增强展示效果的功能，不是核心试衣功能的必需品。用户可以在默认背景下完成试衣，因此是P3优先级。

**Independent Test**: 可以通过点击"场景"区域的"+"按钮展开、上传背景图片、选择场景并观察预览区域背景变化来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在虚拟试衣页面，**When** 点击"场景"区域的"+"按钮，**Then** 场景区域展开，显示类似服装区域的上传界面
2. **Given** 场景区域已展开，**When** 用户上传场景图片，**Then** 场景以卡片形式显示在场景列表中
3. **Given** 用户点击某个场景卡片，**When** 选择该场景，**Then** 左侧主预览区域的背景更新为所选场景，模特和服装保持不变

---

### Edge Cases

- **图片格式不支持时**：用户上传非图片文件或不支持的图片格式（如TIFF、BMP），系统应显示错误提示"不支持的文件格式，请上传 JPG、PNG 或 WEBP 格式的图片"
- **图片尺寸超限时**：用户上传超大尺寸图片（如超过10MB），系统应提示"图片文件过大，请上传小于10MB的图片"
- **网络中断时**：上传过程中网络中断，系统应显示"上传失败，请检查网络连接后重试"，允许用户重新上传
- **空资源库状态**：用户首次使用时，"衣服"区域展开后只显示上传区域和引导文案，没有服装卡片
- **模特图片加载失败**：预设模特图片加载失败时，显示占位图和错误提示
- **同时选择多个服装**：用户尝试同时选中多件服装时，系统只允许选中最后点击的一件（单选模式）
- **未选择模特直接选服装**：用户未选择模特就选择服装时，系统应提示"请先选择模特"或自动选择第一个默认模特
- **服装卡片数量过多**：当用户上传超过20件服装时，右侧区域支持垂直滚动浏览
- **重复上传相同文件**：用户上传已存在的文件时，系统允许重复上传，作为新的服装条目添加到列表中

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须在页面加载时显示至少2个预设模特选项，每个模特显示为缩略图形式
- **FR-002**: 系统必须支持用户点击模特缩略图来选择模特，选中状态需有红色边框高亮视觉反馈
- **FR-003**: 系统必须在用户选择模特后，立即在主预览区域更新显示该模特的完整图像
- **FR-004**: 系统必须在右侧提供"衣服"和"场景"两个独立的可折叠区域
- **FR-005**: 系统必须为"衣服"区域提供展开/收起控件，初始状态为收起，按钮显示"-"图标
- **FR-006**: 系统必须在"衣服"区域展开时，显示虚线框的上传区域，内含"upload from files"按钮
- **FR-007**: 系统必须支持用户点击上传区域或"upload from files"按钮来触发文件选择对话框
- **FR-008**: 系统必须限制上传的文件类型为图片格式（JPG、PNG、WEBP）
- **FR-009**: 系统必须限制单个上传文件的大小不超过10MB
- **FR-010**: 系统必须在文件上传过程中显示进度指示器
- **FR-011**: 系统必须在上传完成后，将新服装以卡片形式添加到"衣服"区域的网格列表中
- **FR-012**: 系统必须为每件服装卡片显示以下信息：服装图片、服装名称、库存状态（"IN STOCK"）、数量
- **FR-013**: 系统必须以3列网格布局展示服装卡片
- **FR-014**: 系统必须支持用户点击服装卡片来选择服装，选中的卡片显示红色边框高亮
- **FR-015**: 系统必须确保同一时间只能选中一件服装（单选模式）
- **FR-016**: 系统必须在用户选择服装后，更新左侧主预览区域显示该服装的虚拟试衣效果
- **FR-017**: 系统必须为"场景"区域提供展开/收起控件，初始状态为收起，按钮显示"+"图标
- **FR-018**: 系统必须在左侧导航栏提供"Create"、"Inventories"、"Clothing"三个导航选项
- **FR-019**: 系统必须在文件上传失败时显示明确的错误提示信息
- **FR-020**: 系统必须支持"衣服"和"场景"区域内容超出可视范围时的垂直滚动

### Key Entities

- **Model（模特）**: 代表虚拟试衣的基础人物形象，包含全身照片、身型特征。系统提供预设模特供用户选择，用户在底部"Select Model"区域进行选择。
- **Garment（服装）**: 用户上传的服装图片资源，包含图片文件、服装名称、库存状态、数量、上传时间等属性。在界面上以卡片形式展示。
- **Scene（场景）**: 用户上传的背景场景图片，包含图片文件、场景类型等属性，用于更换虚拟试衣的展示背景。
- **Try-on Session（试衣会话）**: 代表一次完整的虚拟试衣操作，关联用户选中的模特、服装、场景，记录用户的当前试衣配置状态。
- **Upload Zone（上传区域）**: 虚线框的文件上传触发区域，支持点击触发和可能的拖拽上传（未来扩展）。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能在3秒内完成模特选择操作，从打开页面到确认模特
- **SC-002**: 用户能在5秒内找到并点击服装上传区域，首次使用无需帮助文档
- **SC-003**: 单张图片（2MB以内）的上传时间不超过5秒，上传成功率达到95%以上
- **SC-004**: 服装卡片选择响应时间少于500毫秒，从点击到显示红色边框和预览更新
- **SC-005**: 折叠区域的展开/收起动画时间少于300毫秒，交互流畅无卡顿
- **SC-006**: 90%的用户能在首次使用时成功完成完整流程：选择模特→上传服装→选择服装查看试衣效果
- **SC-007**: 界面支持同时展示至少20件服装卡片而不影响滚动和选择性能
- **SC-008**: 用户从选择服装到看到虚拟试衣效果的等待时间不超过2秒

## Assumptions *(mandatory)*

1. **图片处理能力**: 假设系统后端具备基础图片处理能力，包括生成缩略图、格式验证、尺寸校验
2. **虚拟试衣AI引擎**: 假设系统已集成或将集成AI虚拟试衣引擎，能够根据模特和服装生成试衣效果图
3. **存储方案**: 假设系统有足够的存储空间来保存用户上传的服装和场景图片（预计每用户50-100MB）
4. **模特资源**: 假设系统已预置至少2个高质量的模特全身照片作为默认选项
5. **浏览器兼容性**: 假设目标用户使用现代浏览器（Chrome 90+、Safari 14+、Firefox 88+），支持HTML5文件上传API和CSS Grid布局
6. **网络环境**: 假设用户在正常网络环境下使用（4G/5G/WiFi），平均上传速度不低于1Mbps
7. **服装图片质量**: 假设用户上传的服装图片是正面平铺或穿着展示图，背景相对干净，系统不负责图片预处理
8. **默认命名规则**: 假设系统为上传的服装自动生成名称（如"Garment 1"、"Garment 2"），用户可在后续版本中编辑名称
9. **库存状态**: 假设所有上传的服装默认状态为"IN STOCK"，数量为"1"

## Dependencies *(optional)*

- **用户认证系统**: 本功能依赖现有的用户登录和会话管理系统，确保每个用户的服装库数据隔离
- **文件存储服务**: 需要集成云存储服务（如OSS、S3）或配置本地存储路径用于保存上传的图片
- **图片处理库**: 后端需要集成图片处理库以生成缩略图、验证格式和尺寸
- **AI虚拟试衣引擎**: 需要集成第三方或自研的AI试衣算法服务，接收模特和服装图片，返回试衣效果图
- **现有导航系统**: 左侧导航栏（Create、Inventories、Clothing）需与现有路由和页面结构对接

## Out of Scope *(optional)*

以下功能明确不在本期范围内：

- **拖拽上传**: 不支持将文件拖拽到虚线框区域进行上传，仅支持点击触发文件选择
- **服装名称编辑**: 不支持用户自定义修改服装名称，使用系统自动生成的名称
- **服装标签和分类**: 不支持为服装添加标签、分类或搜索功能
- **批量删除**: 不支持选中多件服装进行批量删除操作
- **服装详情页**: 不提供点击服装卡片进入详情页查看大图或更多信息的功能
- **图片编辑**: 不提供裁剪、旋转、滤镜等图片编辑功能
- **社交分享**: 不包含试衣结果的保存和分享到社交平台功能
- **移动端响应式适配**: 本期仅针对桌面端设计（分辨率1280x720以上），不保证移动端体验
- **服装推荐**: 不包含基于用户偏好或历史的智能服装推荐功能
- **多人协作**: 不支持多个用户共享或协作编辑同一个服装库
- **版本历史**: 不记录服装上传历史或试衣效果的版本记录
