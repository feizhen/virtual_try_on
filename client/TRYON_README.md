# 虚拟试衣功能使用说明

## 功能概述

基于设计稿实现的全新虚拟试衣界面,提供更直观的交互体验。

## 访问方式

1. **开发服务器**: 确保前端服务器正在运行
   ```bash
   cd client
   pnpm dev
   ```

2. **访问页面**:
   - 首页: http://localhost:5174/
   - 点击「新版虚拟试衣」按钮
   - 或直接访问: http://localhost:5174/tryon

## 页面布局

```
┌─────────────────────────────────────────────────────┐
│                    预览区域                          │
│                 (中央大图显示)                        │
│                                                      │
│                                                      │
├──────────────────────────────────┬──────────────────┤
│                                  │  右侧面板:        │
│                                  │  - 服装库 (可折叠)│
│                                  │  - 开始试衣按钮   │
│                                  │                  │
├──────────────────────────────────┴──────────────────┤
│  底部模特选择栏 (横向滚动)                            │
│  [+上传] [模特1] [模特2] [模特3] ...                 │
└─────────────────────────────────────────────────────┘
```

## 使用流程

### 1. 上传/选择模特照片
- 在底部模特选择栏点击 `+` 上传按钮
- 或从已上传的模特中选择一个
- 选中的模特会显示**红色边框**

### 2. 上传/选择服装
- 在右侧服装面板:
  - 点击上传区域或拖拽文件上传
  - 支持格式: JPG, PNG, WEBP
  - 最大大小: 10MB
- 从服装网格中选择一件服装
- 选中的服装会显示**红色边框**

### 3. 开始试衣
- 确保已选择模特和服装
- 点击「开始试衣」按钮
- 等待 AI 处理 (通常 5-30 秒)
- 结果会自动显示在中央预览区

## 功能特性

### 上传功能
- ✅ 拖拽上传支持
- ✅ 实时进度显示
- ✅ 客户端验证 (类型、大小、尺寸)
- ✅ 自动选中新上传项

### 选择交互
- ✅ 红框高亮选中项
- ✅ 点击切换选择
- ✅ 支持取消选择 (再次点击)

### 试衣流程
- ✅ 自动轮询会话状态
- ✅ 实时显示处理进度
- ✅ 支持失败重试
- ✅ 历史记录保存 (最多 10 条)

### UI 特性
- ✅ 3列网格布局 (服装卡片)
- ✅ 可折叠面板 (+/- 图标)
- ✅ 响应式设计
- ✅ 加载状态动画

## 技术架构

### 前端组件

```
src/
├── pages/
│   └── VirtualTryOn.tsx          # 主页面
├── components/VirtualTryOn/
│   ├── ModelSelector.tsx          # 底部模特选择栏
│   ├── PreviewArea.tsx            # 中央预览区
│   ├── GarmentPanel.tsx           # 右侧服装面板
│   ├── TryOnButton.tsx            # 试衣按钮
│   └── styles.css                 # 共享样式
├── contexts/
│   └── TryOnContext.tsx           # 全局状态管理
├── api/
│   ├── model.ts                   # 模特 API
│   ├── garment.ts                 # 服装 API
│   └── tryon.ts                   # 试衣 API
├── types/
│   ├── model.ts                   # 模特类型
│   ├── garment.ts                 # 服装类型
│   └── tryon.ts                   # 试衣类型
└── utils/
    ├── fileUpload.ts              # 文件上传工具
    └── imageValidation.ts         # 图片验证工具
```

### API 端点映射

- **模特管理**: `POST/GET /api/outfit-change/models/upload`
- **服装管理**: `POST/GET /api/outfit-change/clothing/upload`
- **虚拟试衣**: `POST /api/outfit-change/tryon`
- **会话状态**: `GET /api/outfit-change/sessions/:id`

### 状态管理

使用 React Context API 管理全局状态:
- `selectedModel`: 选中的模特
- `selectedGarment`: 选中的服装
- `currentSession`: 当前试衣会话
- `tryOnHistory`: 试衣历史记录

## 常见问题

### 1. 上传失败
- 检查文件格式 (仅支持 JPG/PNG/WEBP)
- 检查文件大小 (最大 10MB)
- 检查网络连接

### 2. 试衣失败
- 确保后端服务正常运行
- 检查后端日志错误信息
- 确认 AI 服务 (Gemini) 配置正确

### 3. 页面无响应
- 检查浏览器控制台错误
- 清除浏览器缓存
- 重启开发服务器

## 后续优化 (可选)

- [ ] 场景管理功能 (P3)
- [ ] 更多可折叠面板
- [ ] 批量上传
- [ ] 图片裁剪/编辑
- [ ] 历史记录导出
- [ ] E2E 测试

## 设计参考

本功能基于以下设计稿实现:
- `documents/design/Wireframe - 1.png`
- `documents/design/upload.jpg`

## 技术栈

- React 19.2 + TypeScript 5.1+
- Vite 7 (开发工具)
- React Context API (状态管理)
- Axios (HTTP 客户端)
- CSS Variables (样式)

---

**开发完成日期**: 2025-10-23
**状态**: ✅ MVP 完成 (US1-US3)
